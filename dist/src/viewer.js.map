{"version":3,"sources":["viewer.js"],"names":["$w","state","getWeather","temp","date","description","uri","stringDate","toDateString","text","city","country","isCelsius","src","updateWeather","res","fetch","then","response","json","myJson","weather","Math","round","main","Date","dt","icon","createControllers","controllerConfigs","map","config","connections","length","console","log","time","pageReady","updateWeatherInterval","onClick","event","setInterval","module","exports","initAppForPage"],"mappings":"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","file":"viewer.js","sourcesContent":["let state;\n\nconst createControllers = controllerConfigs =>\n    controllerConfigs.map(async function (config) {\n        if (config.connections.length !== 7) {\n            return ''\n        }\n        console.log('config', config);\n        state = config.config;\n        let time=state.time*1000;\n        return {pageReady: ($w) => updateWeatherInterval($w,state,time)}\n    });\n\nfunction updateWeatherInterval($w,state,time){\n    $w(\"@button_role\").onClick((event, $w) => {\n        updateWeather($w,state);\n    } );\n    updateWeather($w,state);\n    setInterval(async () => {\n        updateWeather($w,state);\n    },time)\n\n}\n\n\n\n\nasync function updateWeather($w,state){\n    const  {temp,date,description,uri} = await getWeather(state)\n    const stringDate=date.toDateString()\n    $w('@city_role').text = state.city + \",\" + state.country;\n    $w('@degree_role').text = state.isCelsius ? temp + \" C\" : temp + \"F\";\n    $w('@description_role').text =description;\n    $w('@date_role').text =stringDate;\n    $w('@icon_role').src=uri;\n}\n\n\nasync function getWeather(state){\n    let res={};\n    let weather = await fetch('https://api.openweathermap.org/data/2.5/weather?q=' + state.city + ',' + state.country + '&appid=43556639500a52c1c1019b11d77b599b')\n        .then(function (response) {\n            return response.json();\n        })\n        .then(function (myJson) {\n            return myJson;\n        });\n    res.temp = state.isCelsius ? Math.round(weather.main.temp - 273.15) : Math.round((1.8 * (weather.main.temp - 273) + 32));\n    res.date=new Date(weather.dt*1000)\n    res.description=weather.weather[0].description;\n    res.uri='https://openweathermap.org/img/w/'+weather.weather[0].icon+'.png'\n    return res;\n}\n\nmodule.exports = {\n  initAppForPage: () =>{},\n  createControllers,\n  exports: {}\n};\n"]}